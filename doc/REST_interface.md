---
author: "Jan van der Laan, Edwin de Jonge"
title: REST API for CSPA service
version: 0
published: true
---

CSPA (ref) models statistical processes in terms of statistical services that process data in sequence. Each processing step needs input data and configuration parameters and delivers output data and logging data. CSPA does not enforce an interface for services because the partners are working on different platforms. One of proposed architectures is REST: REpresentational State Transfer. RESTful application use HTTP request for CRUD (Create, Read, Update and Delete) operations and maps these on the HTTP verbs POST, GET, PUT and DELETE. All state is modeled with resources. In this document we model a REST interface for CSPA services.

We consider the following as a resource:

- input data are *data resources* to be retrieved by the service.
- results are *data resources* generated by the service.
- log files are *text resources* generated by the service.
- one processing step is modelled as a *job resource* located at the service.

Therefore, calling the service translates to creating a job resource that contains URLs to input data resources. When the service has finished, the job resource will contain URLs to the generated results and logs.

A job resource contains:

- *id*: job id to be used in querying the job properties.
- *url*: (unique) URL to this job (includes job id)
- *name*: human readable name of the calling process
- *version*: version of the service that created this job.
- *input*:
  - Data resources: URL endpoints to input data, that are to be retrieved using GET by the service
  - Configuration parameters: 
    - Simple type (string, integer, float) as value
    - URL endpoint to complex configuration objects.
- *result*:
  - Data resources: URL endpoints to generated output data that are to be serviced by the service. (in the future this might be on a different server, but for now it is local on the service)
- *status*: ["created", "scheduled", "running", "finished", "error"]
- *created*: datetime (UTC)
- *started*: datetime (UTC)
- *finished*: datetime (UTC)
- *on_end*: callback url


Creating, reading and deleting service jobs
===========================================

At `/my_service/job` new jobs can be submitted to the service and job information can be retrieved

### `POST /my_service/job`

Creates a new job. On successful creation http status code 201 is returned with a url to the newly created job. The minimal information that is needed is:

- `name`: used by the calling process to name this job
- `input`: the input parameters of the service. Typically these are urls to data resources. The exact contents of `input` depends on the particular service and must match the required input parameters of the particular service.

Optional:

- `on_end`: a callback url. When the job is ended (finished or error), the service will `POST` the job resource to this url.

Format in JSON:
```json
{  "name" : "my_process",
   "input" : {
      "data": "http://allthedatayouneed.com/mydata.csv",
      "rules": "http://allthedatayouneed.com/myrules.txt" 
      ... // other parameters
  },
  "on_end" : "http://callback.com"
}
```

### `GET my_service/job`

Retrieves all active jobs as an array of jobs (see `/job/<id>`)


### `GET my_service/job/<id>`

Returns information on the status of the job and links to the output data. The results of the data are stored in the `result` part of the job. When the job is not yet finished this part may be unavailable.

Format in JSON:
```json
{
 "id" : "1234",
 "url" : "http://example.com/my_service/job/1234",
 "version": "0.0.1",
 "name" : "my_process",
 "status" : "created" | "running" | "finished" | "error",
 "input" : {
    "data" : "http://allthedatayouneed.com/mydata.csv",
    "rules": "http://allthedatayouneed.com/myrules.txt", 
    ...
 }, 
 "result": {
    "data" : "http://example.com/my_service/job/1234/result/data",
    ...
  }, // result parameters
 "log": {"url": "http://example.com/my_service/job/1234/log", "type":"text"},
 "created": "2014-01-01T12:00" ,
 "started": "2014-01-01T12:00" ,
 "ended": "2014-01-01T12:01" ,
 "on_end" : "http://callback.com"
}
```

### `DELETE my_service/job/<id>`

Cancels the job and deletes all data belonging to the job from the service. 


### `GET my_service/job/<id>/result/<param>`

Retrieve a (data) resource that was generated by this job. If the job is still running, this may return "not available".
Example:
```
http://example.com/service/job/1234/result/data
```

Format: depends on service

### `GET my_service/job/<id>/log`

Retrieves the logging information of this job. Typically this is a text file.

Example:
```
http://example.com/my_service/job/1234/log
```


Other resources on the service
==============================

### `GET my_service/help`

Human readable help describing input and output parameters.

### `GET my_service/example`

Shows a working test example for this service.



Other considerations
====================

## Data resources

Data resource for now are urls, but can be expanded with more intelligence (query, type, dataproviders, etc.)

## Service versioning

A service will apply semantic versioning: a client can ask for a specific version of the service in the HEAD using

`Accept-Version=<version number>`  where the version is a semantic versio number. If omitted, it will by default use the latest version of the service.



Open ends
=========

We currently do not address:

## resource management. 

Services in this design are responsible for the created output. However in a next version this responsibility may be delegated to a resource management system.

## data transformation, selection and filtering.
It is up to the orchestrator/caller of the service to supply the input data in the correct format and syntax. 
However this may be a general service to transform/select data, which may be combined with the resource manager (it may be implemented as transformation, mapping of filtering query on resources).

## authorization and authentication.
In a production system controlling the service must be restricted to an adminstrator. Callers should not be able to see other job information.

