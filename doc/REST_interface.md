---
author: "Jan van der Laan, Edwin de Jonge"
title: REST API for CSPA service
version: 0
published: true
---

CSPA (ref) models statistical processes in terms of statistical services that process data in sequence. Each processing step needs input data and configuration parameters and delivers output data and logging data. CSPA does not enforce an interface for services because the partners are working on different platforms. One of proposed architectures is REST: representational State Transfer. 

RESTful application use HTTP request for CRUD (Create Read Update and Delete) operations and maps these on (POST, GET, PUT and DELETE). All state is modeled with resources.

In this document we model a REST interface for CSPA services.
We consider the following as a resource:

- input data are *data resources* to be retrieved by the service.
- results are *data resources* generated by the service.
- log files are *text resources* generated by the service.
- One processing step is modelled as a *job resource* located at the service.

So calling the service in a REST interface translates to creating a job resource that contains URLs to input data resources. When the call has finished, the job resource will contain URLs to the generated results and logs.

A job resource contains:
- *id*: job id to be used in querying the job properties.
- *url*: (unique) URL to this job (includes job id)
- *name*: Human readable name of calling process
- *input*:
	- Data resources: URL endpoints to input data, that are to be retrieved using GET by 
	the service
	- Configuration parameters: 
    	- Simple type (string, integer, float) as value
  		- URL endpoint to complex configuration objects.
- *result*:
	Data resources: URL endpoints to generated output data that are to be serviced by the service. (in the future this might be on a different server, but for now it is local on the service)
- *status*: ["created", "scheduled", "running", "finished", "error"]
- *created*: datetime (UTC)
- *started*: datetime (UTC)
- *ended*: datetime (UTC)
- *on_end*: callback url

Creating a job at service runs a processing step and creates output resources that will be served by the service.

Resources:
- `/job`
	CREATE, READ and DELETE service jobs
- `/help`
	Human readable help describing input and output parameters.
- `/example`
    Shows a working test example for this service.
    
## /job

This is the place where new jobs can be submitted to the service and job information can be retrieved

### `POST` /my_service[/job]

Creates a new job. On succesful creation http status code 201 is returned with a url to the newly created job.
The minimal information that is needed are:
- `name`: used by the calling process to name this job
- `input`: the input parameters of the service. Typically these are urls to data resources.

Optional:
- `on_end`: a callback url. When the job is ended (finished or error), the service will `POST` the job resource to this url.

The service will create an `id` and URL for the new job.

Format in JSON:
`POST` message format (in JSON) depends on the service definition of the CSPA service. The input part must equal the parameters that are needed for a particalur service.
```json
{  "name" : "my_process",
   "input" : {
      "data": "http://allthedatayouneed.com/mydata.csv",
      "rules": "http://allthedatayouneed.com/myrules.txt" 
      ... // other parameters
  },
  "on_end" : "http://callback.com"
}
```

### `GET` my_service/job

Retrieves all active jobs as an array of jobs (see `/job/<id>`)

## `GET` "my_service/job/<id>"

Returns information on the status of the job and links to the output data.
If the job is not ended, these may not yet be available.

Format:
```json
{
 "id" : "1234",
 "url" : "http://example.com/my_service/job/1234",
 "name" : "my_process",
 "status" : "created" | "running" | "finished" | "error",
 "input" : {
    "data" : "http://allthedatayouneed.com/mydata.csv"
    "rules" : {"url" : "http://data.com/my_rules.txt", "type": "txt" }
    ...
 }, 
 "result": {
    "data" : "http://example.com/my_service/job/1234/result/data.csv",
    ...
  }, // result parameters
 "log": {"url": "http://example.com/my_service/job/1234/log", "type":"text"},
 "created": 2014-01-01T12:00 ,
 "started": 2014-01-01T12:00 ,
 "ended": 2014-01-01T12:01 ,
 "on_end" : "http://callback.com"
}
```

### `DELETE` "my_service/job/<id>"

Cancels the job and deletes all data belonging to the job from the service. 


### `GET` "my_service/job/<id>/result/<param>"

Retrieve a (data) resource that was generated by this job. If the job is still running, this may return "not available".
Example:
```
http://example.com/service/job/1234/result/data
```

Format: depends on service

### `GET` "my_service/job/<id>/log"

Retrieves the logging information of this job. Typically this is a text file.

Example:
```
http://example.com/my_service/job/1234/log
```


## Data resources

Data resource for now are urls, but can be expanded with more intelligence (query, type, dataproviders, etc.)

## Versioning off service

A service will apply semantic versioning: a client can ask for a specific version of the service in the HEAD using

`accept-version=<version number>`  where the version is a semantic versio number. If omitted, it will by default use the latest version of the service.

# Open ends

We currently do not address:

## resource management. 

Services in this design are responsible for the created output. However in a next version this responsibility may be delegated to a resource management system.

## data transformation, selection and filtering.
It is up to the orchestrator/caller for the service to supply the input data in the correct format and syntax. 
However this may be a general service to transform/select data, which may be combined with the resource manager (it may be implemented as transformation, mapping of filtering query on a resource.

## authorization and authentication of calling the REST services.
In a production system controlling the service must be restricted to an adminstrator. Callers should not be able to see other job information

